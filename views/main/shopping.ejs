<!-- Place here your css styles -->
<link rel="stylesheet" href="/css/shopping.css"/>

<!-- Body -->

<!--Navigation Bar-->
<nav>
    <a href="/">
        <div class="logo">
            <h1>Rental <span> Hub</span></h1>
        </div>
    </a>
    <div class="search-bar">
        <input type="text" placeholder="Search"/>
        <button><img src="/images/search.png"/></button>
    </div>
    <ul>
        <li><a href="/">Home</a></li>
        <li>
            <a href="/dashboard/listing"
            ><img src="/images/blueAdd.png" class="add-icon"
                /></a>
        </li>
        <li>
            <a href="/dashboard/profile">
                <img
                        src="/images/blueProfile.png"
                        alt="Profile"
                        class="profile-icon"
                />
            </a>
        </li>
    </ul>
</nav>

<!-- Categories -->
<div class="categories-cont">
    <button class="category active" onclick="openCategory('events-and-parties')">
        Events & Parties
    </button>

    <button class="category" onclick="openCategory('tech-and-gadgets')">
        Tech & Gadgets
    </button>

    <button class="category" onclick="openCategory('clothing-and-accessories')">
        Clothing & Accessories
    </button>

    <button class="category" onclick="openCategory('sports-and-outdoor-gear')">
        Sports & Outdoor Gear
    </button>

    <button class="category" onclick="openCategory('tools-and-equipment')">
        Tools & Equipment
    </button>

    <button class="category" onclick="openCategory('musical-instruments')">
        Musical Instruments
    </button>

    <button class="category" onclick="openCategory('home-and-office')">
        Home & Office
    </button>

    <button class="category" onclick="openCategory('pets-accessories')">
        Pets Accessories
    </button>
</div>

<!-- Tabs -->
<div id="shopping-container"></div>


<!--Scripts-->
<script>
    let items = [];

    // Listings Display
    document.addEventListener("DOMContentLoaded", async function () {
        // Get the URL parameter after shopping/
        const category = window.location.pathname.split("/").pop();
        console.log('start')

        const data = await fetch(`/api/listing/${getCategoryId(category)}`)
            .then((response) => response.json())
            .then((data) => {
                // items = data.data;
                return data.data
            })

        let shoppingList = ''

            shoppingList = document.createElement("ul");
            shoppingList.className = "shoppingList"; // For CSS

        data.forEach(item => {
            console.log(item)
            let shoppingContainer = document.getElementById('shopping-container');
            if (!shoppingContainer) return;

            // if (!shoppingList) {
                shoppingContainer.appendChild(shoppingList);
            // }

            let li = document.createElement("li");
            li.className = "shoppingItem"; // For CSS
            li.innerHTML = `
              <img src="${item.image}" alt="Item Image" class="itemImage">
              <br>
              <hr>
              <strong>${item.name}</strong>
              <br>
              <br>
              <strong>‚Ç± ${item.price} per day</strong>
              <br>
              üìç: ${item.location}
              <br>
            `;


            // Make the item clickable
            li.addEventListener("click", function () {
                localStorage.setItem("selectedItem", JSON.stringify(item));
                window.location.href = "/dashboard/view-product";
            });

            shoppingList.appendChild(li);
        });
            // })
            // .catch((error) => {
            //     console.error("Error:", error);
            // });

        console.log('end')
    });


    // Tabs Functionality
    function openCategory(categoryName) {
        // Redirect to the category page with the path
        window.location.href = `/shopping/${categoryName}`;
    }

    // Set the active category based on URL path
    document.addEventListener("DOMContentLoaded", function () {
        const path = window.location.pathname;
        const category = path.split("/").pop();

        if (category) {
            // Hide all shoppingContainers
            document.querySelectorAll(".shoppingContainer").forEach((container) => {
                container.style.display = "none";
            });

            // Show the selected category container
            const selectedContainer = document.getElementById(category);
            if (selectedContainer) {
                selectedContainer.style.display = "block";
            } else {
                console.error(`No element found with ID: ${category}`);
            }

            // Remove active class from all buttons
            document.querySelectorAll(".category").forEach((button) => {
                button.classList.remove("active");
            });

            // Add active class to the button corresponding to the category
            const activeButton = document.querySelector(`.category[onclick="openCategory('${category}')"]`);
            if (activeButton) {
                activeButton.classList.add("active");
            } else {
                console.error(`No button found for category: ${category}`);
            }
        } else {
            // Default to the first category if no category is specified
            const defaultCategory = document.querySelector(".category").getAttribute("onclick").match(/'([^']+)'/)[1];
            openCategory(defaultCategory);
        }
    });


    document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("event-and-parties").style.display = "block";

    });


    //home to shopping
    document.addEventListener("DOMContentLoaded", function () {
        // Get the URL parameters
        const params = new URLSearchParams(window.location.search);
        const category = params.get("category");

        if (category) {
            // Hide all shoppingContainers
            document
                .querySelectorAll(".shoppingContainer")
                .forEach((container) => {
                    container.style.display = "none";
                });

            // Show the selected category container
            const selectedContainer = document.getElementById(category);
            if (selectedContainer) {
                selectedContainer.style.display = "block";
            }
        }
    });
</script>
<script src="/js/get-category-id.js"></script>