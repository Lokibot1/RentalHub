<link rel="stylesheet" href="/css/archives.css"/>
<link rel="web icon" type="png" href="/images/webicon.png">
<!--Navigation Bar-->
<%- include('../partials/user/header-navbar.ejs'); %>

<div class="main">
    <!--Sidebar-->
    <%- include('../partials/user/sidebar.ejs'); %>

    <!--Main Content-->
    <div class="content">
        <button id="restore-btn" class="restore-btn">Restore All</button>
        <div class="shoppingList">
          <a href="/view-archive">
            <div class="shoppingItem">
              <img src="" alt="" class="itemImage" />
              <hr />
              <strong class="itemName">Name</strong>
              <br />
              <strong class="itemPrice">$123</strong>
              <br />
              <strong class="itemLocation">Jan lang</strong>
            </div>
          </a>
        </div>
      </div>
    <!--Confirmation Modal-->
    <div id="overlay" class="overlay"></div>
    <div id="restore-Modal" class="modal">
      <div class="modal-content">
        <h3>
          Are you sure you want to
          <span style="color: #009959">restore</span> this item?
        </h3>
        <div class="modal-buttons">
          <button class="btn-yes" id="confirmBan">Yes</button>
          <button class="btn-no" id="cancelBtn">No</button>
        </div>
      </div>
    </div>
    <div id="restoreToast" class="toast"></div>
  </div>
</div>

  <!-- Logout Confirmation Modal -->
  <div id="logout-modal" class="logout-modal">
    <div class="logout-content">
      <p>Are you sure you want to log out?</p>
      <div class="logout-button-group">
        <button id="confirm-logout" class="yes-btn">Yes</button>
        <button id="cancel-logout" class="no-btn">No</button>
      </div>
    </div>
  </div>

<!--JAVASCRIPT-->
<script>
    document.addEventListener("DOMContentLoaded", fetchArchivedListings);

    // FETCH ARCHIVED LISTINGS FROM THE BACKEND
    async function fetchArchivedListings() {
        try {
            const response = await fetch("/api/archived-listings");
            const listings = await response.json();
            const archiveList = document.getElementById("archive-list");

            archiveList.innerHTML = ""; // Clear previous content

            if (listings.length === 0) {
                archiveList.innerHTML = "<p>No archived items found.</p>";
                return;
            }

            listings.forEach((listing) => {
                const listingCard = document.createElement("div");
                listingCard.classList.add("listing-card");
                listingCard.innerHTML = `
            <p class="listing-title">${listing.title}</p>
            <div class="listing-item">
              <img src="${listing.image || 'placeholder.png'}" alt="Listing Image" class="listing-image">
              <span class="listing-name">${listing.name}</span>
            </div>
            <button class="restore-btn" onclick="restoreListing('${listing.id}')">Restore</button>
          `;
                archiveList.appendChild(listingCard);
            });
        } catch (error) {
            console.error("Error fetching archived listings:", error);
        }
    }

    // RESTORE A SINGLE LISTING
    async function restoreListing(listingId) {
        try {
            const response = await fetch(`/api/restore-listing/${listingId}`, {
                method: "PUT",
                headers: {"Content-Type": "application/json"},
            });
            if (response.ok) {
                alert("Listing restored successfully.");
                fetchArchivedListings();
            }
        } catch (error) {
            console.error("Error restoring listing:", error);
        }
    }

    // RESTORE ALL ARCHIVED LISTINGS
    async function restoreAllListings() {
        try {
            const response = await fetch(`/api/restore-all`, {
                method: "PUT",
                headers: {"Content-Type": "application/json"},
            });

            if (response.ok) {
                alert("All archived listings have been restored.");
                fetchArchivedListings();
            }
        } catch (error) {
            console.error("Error restoring all listings:", error);
        }
    }
    // Restore Posting
      const restoreIcon = document.getElementById("restore-btn");
      const restoreModal = document.getElementById("restore-Modal");
      const confirmBan = document.getElementById("confirmBan");
      const restoreToast = document.getElementById("restoreToast");

      restoreIcon.addEventListener("click", function (event) {
        event.preventDefault();
        restoreModal.style.display = "flex";
      });
      cancelBtn.addEventListener("click", function () {
        restoreModal.style.display = "none";
      });
      window.addEventListener("click", function (event) {
        if (event.target === restoreModal) {
          restoreModal.style.display = "none";
        }
      });
      function showRestoreToast(message) {
        restoreToast.textContent = message;
        restoreToast.classList.add("show");
        setTimeout(() => {
          restoreToast.classList.remove("show");
        }, 3000);
      }
      confirmBan.addEventListener("click", function () {
        showRestoreToast("Restored Successfully!");
        restoreModal.style.display = "none";
      });
      
//logout
document.addEventListener("DOMContentLoaded", function () {
    const logoutLink = document.getElementById("logout");
    const modal = document.getElementById("logout-modal");
    const confirmLogout = document.getElementById("confirm-logout");
    const cancelLogout = document.getElementById("cancel-logout");
  
    // Ensure modal starts hidden
    modal.style.display = "none";
  
    // Show modal when logout is clicked
    logoutLink.addEventListener("click", function (event) {
      event.preventDefault(); // Prevents default link behavior
      modal.style.display = "flex"; // Show modal only on click
    });
  
    // Redirect when "Yes" is clicked
    confirmLogout.addEventListener("click", function () {
      window.location.href = "/logout"; // Adjust logout URL
    });
  
    // Close modal when "No" is clicked
    cancelLogout.addEventListener("click", function () {
      modal.style.display = "none"; // Hide modal
    });
  });

</script>