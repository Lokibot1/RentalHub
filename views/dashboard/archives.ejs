<link rel="stylesheet" href="/css/archives.css" />

<!--Navigation Bar-->
<nav>
    <a href="/">
      <div class="logo">
        <h1>Rental<span>Hub</span></h1>
      </div>
    </a>
    <ul>
      <li><a href="/shopping">Shop</a></li>
      <li>
        <a href="/listing"
          ><img src="/images/WhiteAdd.png" class="add-icon"
        /></a>
      </li>
      <li>
        <a href="/login">
          <img
            src="/images/Icon1.png"
            alt="Profile"
            class="profile-icon"
          />
        </a>
      </li>
    </ul>
  </nav>

  <div class="main">
    <!--Sidebar-->
    <div class="sidebar">
      <ul>
        <li><a href="/dashboard/user-dashboard" class="active">Dashboard</a></li>
        <li><a href="/dashboard/profile">Profile</a></li>
        <li><a href="/dashboard/rents">My Rents</a></li>
        <li><a href="/dashboard/my-listing">My Listings</a></li>
        <li><a href="/dashboard/archives">Archives</a></li>
        <li><a href="/logout">Log Out</a></li>
      </ul>
    </div>

    <!--Main Content-->
    <div class="content">
      <button class="restore-btn">Restore All</button>
    </div>
  </div>

  <!--JAVASCRIPT-->
  <script>
    document.addEventListener("DOMContentLoaded", fetchArchivedListings);

    // FETCH ARCHIVED LISTINGS FROM THE BACKEND
    async function fetchArchivedListings() {
      try {
        const response = await fetch("/api/archived-listings");
        const listings = await response.json();
        const archiveList = document.getElementById("archive-list");

        archiveList.innerHTML = ""; // Clear previous content

        if (listings.length === 0) {
          archiveList.innerHTML = "<p>No archived items found.</p>";
          return;
        }

        listings.forEach((listing) => {
          const listingCard = document.createElement("div");
          listingCard.classList.add("listing-card");
          listingCard.innerHTML = `
            <p class="listing-title">${listing.title}</p>
            <div class="listing-item">
              <img src="${listing.image || 'placeholder.png'}" alt="Listing Image" class="listing-image">
              <span class="listing-name">${listing.name}</span>
            </div>
            <button class="restore-btn" onclick="restoreListing('${listing.id}')">Restore</button>
          `;
          archiveList.appendChild(listingCard);
        });
      } catch (error) {
        console.error("Error fetching archived listings:", error);
      }
    }

    // RESTORE A SINGLE LISTING
    async function restoreListing(listingId) {
      try {
        const response = await fetch(`/api/restore-listing/${listingId}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
        });
        if (response.ok) {
          alert("Listing restored successfully.");
          fetchArchivedListings();
        }
      } catch (error) {
        console.error("Error restoring listing:", error);
      }
    }

    // RESTORE ALL ARCHIVED LISTINGS
    async function restoreAllListings() {
      try {
        const response = await fetch(`/api/restore-all`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
        });

        if (response.ok) {
          alert("All archived listings have been restored.");
          fetchArchivedListings();
        }
      } catch (error) {
        console.error("Error restoring all listings:", error);
      }
    }
  </script>